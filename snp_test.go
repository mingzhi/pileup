package pileup

import (
	"testing"
)

func TestParse(t *testing.T)  {
    line := "GCA_000155815.1_ASM15581v1	355	G	57	...$,,+1a.,,,,.,.,$,,,.,.,,..,..,,,.,,.,.,,,,,,,..,,.,.,.....,	fkDG>fGGF@iG:AGGGDGEGFfHGgGFEGEEDGGEBGDDEEBFEEEGCG>GGGGG<	HWUSI-EAS1567_102422097:8:63:14113:4343,HWUSI-EAS1567_102422097:8:57:11485:17405,HWUSI-EAS1567_102422097:8:83:4109:10819,HWUSI-EAS1567_102422097:8:58:19327:16998,HWUSI-EAS1567_102422097:8:47:9466:7170,HWUSI-EAS1567_102422097:7:49:14140:11973,HWUSI-EAS1567_102422097:7:5:7400:13326,HWUSI-EAS1567_102422097:8:72:14296:9205,HWUSI-EAS1567_102422097:8:12:2402:14446,HWUSI-EAS1567_102422097:7:65:10822:10015,HWUSI-EAS1567_102422097:7:14:8600:11141,HWUSI-EAS1567_102422097:7:108:8138:20292,HWUSI-EAS1567_102422097:7:2:15683:13701,HWUSI-EAS1567_102422097:7:14:10734:15588,HWUSI-EAS1567_102422097:8:92:12021:8551,HWUSI-EAS1567_102422097:8:25:19424:5492,HWUSI-EAS1567_102422097:8:102:18740:20588,HWUSI-EAS1567_102422097:7:71:15168:7694,HWUSI-EAS1567_102422097:7:27:4908:2542,HWUSI-EAS1567_102422097:8:56:8377:6420,HWUSI-EAS1567_102422097:7:83:3093:17976,HWUSI-EAS1567_102422097:8:101:16865:10698,HWUSI-EAS1567_102422097:7:109:12239:16619,HWUSI-EAS1567_102422097:8:88:3107:12076,HWUSI-EAS1567_102422097:7:50:4268:17021,HWUSI-EAS1567_102422097:7:94:13539:11962,HWUSI-EAS1567_102422097:7:111:3728:7361,HWUSI-EAS1567_102422097:7:32:1774:20753,HWUSI-EAS1567_102422097:8:56:2318:3352,HWUSI-EAS1567_102422097:8:90:4967:16592,HWUSI-EAS1567_102422097:7:28:10632:15492,HWUSI-EAS1567_102422097:7:40:10931:10304,HWUSI-EAS1567_102422097:8:75:6817:15254,HWUSI-EAS1567_102422097:8:18:16429:9610,HWUSI-EAS1567_102422097:7:89:12363:6493,HWUSI-EAS1567_102422097:7:42:11074:12268,HWUSI-EAS1567_102422097:8:51:1870:1913,HWUSI-EAS1567_102422097:7:107:13813:7417,HWUSI-EAS1567_102422097:8:54:19553:14382,HWUSI-EAS1567_102422097:7:70:6244:18940,HWUSI-EAS1567_102422097:8:56:5751:9079,HWUSI-EAS1567_102422097:7:113:2623:18837,HWUSI-EAS1567_102422097:7:116:17931:5466,HWUSI-EAS1567_102422097:8:114:8176:12242,HWUSI-EAS1567_102422097:7:28:17812:9813,HWUSI-EAS1567_102422097:8:18:17152:11131,HWUSI-EAS1567_102422097:8:77:14194:13965,HWUSI-EAS1567_102422097:7:93:3900:16842,HWUSI-EAS1567_102422097:8:21:4662:20639,HWUSI-EAS1567_102422097:7:40:7500:15333,HWUSI-EAS1567_102422097:8:78:19485:10470,HWUSI-EAS1567_102422097:7:102:11620:19921,HWUSI-EAS1567_102422097:7:98:10435:11170,HWUSI-EAS1567_102422097:7:1:12694:14018,HWUSI-EAS1567_102422097:8:117:11030:16239,HWUSI-EAS1567_102422097:7:23:7526:7016,HWUSI-EAS1567_102422097:8:88:6075:9866"
    s, err := parse(line)
    if err != nil {
        t.Error(err)
    }
    
    if s == nil {
        t.Error("parse return SNP nil")
    }
    
    if len(s.Alleles) != 57 {
        t.Errorf("Expect 57, got %d\n", len(s.Alleles))
    }
}

func TestDecodeBases(t *testing.T)  {
    s := ".A.$,,+1a.,,,,-2gt.,.,$,,,.,a,,..,..,,,.,,.,.,,,,,,,..,,.,.,.....,"
    bases := decodeReadBases(s, 'G')
    if len(bases) != 57 {
        t.Errorf("Expect %d, got %d: %s\n", 57, len(bases), bases)
    }
    
    if bases[1] != 'A' {
        t.Errorf("Expect %c, got %c\n", 'A', bases[1])
    }
    if bases[0] != 'G' {
        t.Errorf("Expect %c, got %c\n", 'G', bases[0])
    }
}